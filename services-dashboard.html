<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Services - Compliance AI Expert</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Outfit:wght@700;800&display=swap"
        rel="stylesheet">
    <style>
        /* Apply purple gradient background */
        body {
            background: linear-gradient(135deg, #E0E7FF 0%, #F5F3FF 100%);
            min-height: 100vh;
        }

        .dashboard-container {
            max-width: 1200px;
            margin: 80px auto;
            padding: 2rem 32px;
        }

        /* Navigation Enhancements */
        .nav-links {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--gray-700);
            text-decoration: none;
            font-weight: 500;
            transition: color var(--transition-base);
        }

        .nav-link:hover {
            color: var(--primary-blue);
        }

        .client-info-nav {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .client-name-text {
            font-weight: 600;
            color: var(--gray-900);
            font-size: 0.875rem;
        }

        .client-type-text {
            font-size: 0.75rem;
            color: var(--gray-500);
        }

        /* Breadcrumb */
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 2rem;
            font-size: 0.875rem;
            color: var(--gray-600);
        }

        .breadcrumb a {
            color: var(--primary-blue);
            text-decoration: none;
            transition: color var(--transition-base);
        }

        .breadcrumb a:hover {
            color: var(--primary-blue-dark);
        }

        .breadcrumb span:not(:has(a)) {
            color: var(--gray-400);
        }

        /* Page Header */
        .page-header-section {
            margin-bottom: 2rem;
        }

        .page-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 0.5rem;
            font-family: var(--font-display);
        }

        .page-subtitle {
            font-size: 1rem;
            color: var(--gray-600);
        }

        /* Client Details Card */
        .client-details-card {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 3rem;
            box-shadow: 0 4px 20px -5px rgba(0, 0, 0, 0.08);
        }

        .client-details-header {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--gray-100);
        }

        .client-icon-large {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, #3B82F6, #2563EB);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
            font-weight: 700;
            flex-shrink: 0;
        }

        .client-main-info {
            flex: 1;
        }

        .client-main-info h2 {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 0.5rem;
        }

        .client-entity-badge {
            display: inline-block;
            background: var(--gray-100);
            color: var(--gray-700);
            padding: 0.25rem 0.75rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .client-details-body {
            padding-top: 1.5rem;
        }

        .detail-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .detail-label {
            font-size: 0.75rem;
            color: var(--gray-500);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .detail-value {
            font-size: 1rem;
            color: var(--gray-900);
            font-weight: 500;
            font-family: monospace;
        }

        .client-stats-row {
            display: flex;
            gap: 2rem;
            padding-top: 1rem;
            border-top: 1px solid var(--gray-100);
        }

        .stat-item-small {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .stat-icon-small {
            font-size: 1.5rem;
        }

        .stat-value-small {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-900);
            line-height: 1;
        }

        .stat-label-small {
            font-size: 0.75rem;
            color: var(--gray-500);
            margin-top: 0.25rem;
        }

        /* Services Section */
        .services-section-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .services-section-title h2 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-900);
        }

        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.5rem;
        }

        /* Enhanced Service Cards */
        .service-box-enhanced {
            background: white;
            border: 1px solid var(--gray-100);
            border-radius: 16px;
            padding: 2rem;
            cursor: pointer;
            transition: all var(--transition-base);
            display: flex;
            flex-direction: column;
            min-height: 240px;
        }

        .service-box-enhanced:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            border-color: var(--primary-blue-light);
        }

        .service-icon-large {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .service-box-enhanced h3 {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.75rem;
            color: var(--gray-900);
        }

        .service-description {
            font-size: 0.875rem;
            color: var(--gray-600);
            line-height: 1.6;
            flex: 1;
            margin-bottom: 1.5rem;
        }

        .service-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 1rem;
            border-top: 1px solid var(--gray-100);
        }

        .service-action {
            font-size: 0.875rem;
            color: var(--primary-blue);
            font-weight: 600;
        }

        .status-pill {
            font-size: 0.75rem;
            padding: 0.4rem 1rem;
            border-radius: 9999px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .status-active {
            background: #E0F2FE;
            color: #0369A1;
        }

        .add-service-box {
            border: 2px dashed var(--gray-200);
            background: transparent;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .add-service-box:hover {
            border-color: var(--primary-blue);
            background: #F0F9FF;
        }

        /* View Mode Information Section */
        .view-mode-info-section {
            margin-top: 4rem;
            padding: 2.5rem;
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 20px -5px rgba(0, 0, 0, 0.08);
        }

        .info-header {
            text-align: center;
            margin-bottom: 2.5rem;
        }

        .info-header h3 {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 0.5rem;
        }

        .info-header p {
            font-size: 1rem;
            color: var(--gray-600);
        }

        .view-mode-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .view-mode-card {
            padding: 2rem;
            border: 2px solid var(--gray-100);
            border-radius: 12px;
            transition: all var(--transition-base);
        }

        .view-mode-card:hover {
            border-color: var(--primary-blue-light);
            box-shadow: 0 8px 16px -4px rgba(0, 0, 0, 0.1);
        }

        .view-mode-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .view-mode-card h4 {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 1rem;
        }

        .view-mode-description {
            font-size: 0.9375rem;
            color: var(--gray-600);
            line-height: 1.6;
            margin-bottom: 1.5rem;
        }

        .view-mode-features {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .view-mode-features li {
            font-size: 0.875rem;
            color: var(--gray-700);
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--gray-100);
        }

        .view-mode-features li:last-child {
            border-bottom: none;
        }

        .view-mode-note {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            padding: 1.5rem;
            background: linear-gradient(135deg, #EFF6FF, #F0F9FF);
            border-radius: 12px;
            border-left: 4px solid var(--primary-blue);
        }

        .note-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .view-mode-note p {
            margin: 0;
            font-size: 0.9375rem;
            color: var(--gray-700);
            line-height: 1.6;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 3rem;
            border-radius: var(--radius-2xl);
            width: 100%;
            max-width: 600px;
            text-align: center;
        }

        .view-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 2rem;
        }

        .view-option {
            border: 2px solid var(--gray-200);
            padding: 2rem;
            border-radius: var(--radius-xl);
            cursor: pointer;
            transition: all var(--transition-base);
        }

        .view-option:hover {
            border-color: var(--primary-blue);
            background: var(--gray-50);
        }

        .view-option .icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .view-option h4 {
            margin-bottom: 0.5rem;
            font-size: 1.25rem;
        }

        .view-option p {
            font-size: 0.875rem;
            color: var(--gray-600);
        }

        .service-selection-list {
            margin-top: 1.5rem;
            text-align: left;
            max-height: 400px;
            overflow-y: auto;
        }

        .service-selection-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        .service-selection-item:hover {
            background: var(--gray-50);
        }

        .service-selection-item input {
            width: 20px;
            height: 20px;
        }

        .service-info h4 {
            margin: 0;
            font-size: 1rem;
        }

        .service-info p {
            margin: 0;
            font-size: 0.8rem;
            color: var(--gray-500);
        }
    </style>
</head>

<body>
    <!-- Enhanced Navigation -->
    <nav class="navbar">
        <div class="navbar-container">
            <a href="index.html" class="logo">
                <div class="logo-icon">CA</div>
                <span style="font-weight: 700; color: #1e3a8a;">ComplianceAIexpert</span>
            </a>
            <div class="nav-links">
                <a href="clients.html" class="nav-link">
                    <span>üè†</span> Home
                </a>
                <div class="navbar-profile" onclick="window.location.href='profile.html'">
                    <div class="user-avatar-small" id="nav-avatar">C</div>
                    <div class="client-info-nav">
                        <span id="client-name-nav" class="client-name-text">Client Name</span>
                        <span id="client-type-nav" class="client-type-text">Loading...</span>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="dashboard-container">
        <!-- Breadcrumb -->
        <div class="breadcrumb">
            <a href="clients.html">Home</a>
            <span>‚Ä∫</span>
            <a href="clients.html">Clients</a>
            <span>‚Ä∫</span>
            <span id="breadcrumb-client">Client</span>
            <span>‚Ä∫</span>
            <span>Services</span>
        </div>

        <!-- Page Header -->
        <div class="page-header-section">
            <h1 class="page-title">Service Dashboard</h1>
            <p class="page-subtitle">Manage compliance services for <span id="subtitle-client-name">your client</span>
            </p>
        </div>

        <!-- Client Details Card -->
        <div class="client-details-card">
            <div class="client-details-header">
                <div class="client-icon-large" id="client-icon-large">C</div>
                <div class="client-main-info">
                    <h2 id="client-details-name">Loading...</h2>
                    <span class="client-entity-badge" id="client-entity-type">Individual</span>
                </div>
                <div class="client-compliance-badge" id="compliance-status">
                    <span class="badge-ai-capsule badge-ai-success">
                        <span>‚úì</span> Compliant
                    </span>
                </div>
            </div>

            <div class="client-details-body">
                <div class="detail-row">
                    <div class="detail-item">
                        <span class="detail-label">GSTIN</span>
                        <span class="detail-value" id="client-gstin">-</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">PAN</span>
                        <span class="detail-value" id="client-pan">-</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">CIN</span>
                        <span class="detail-value" id="client-cin">-</span>
                    </div>
                </div>

                <div class="client-stats-row">
                    <div class="stat-item-small">
                        <span class="stat-icon-small">üìä</span>
                        <div>
                            <div class="stat-value-small" id="active-services-count">0</div>
                            <div class="stat-label-small">Active Services</div>
                        </div>
                    </div>
                    <div class="stat-item-small">
                        <span class="stat-icon-small">üìÖ</span>
                        <div>
                            <div class="stat-value-small" id="last-updated">Today</div>
                            <div class="stat-label-small">Last Updated</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="services-section-title">
            <h2>Available Services</h2>
            <button class="btn btn-primary" onclick="showAddService()">+ Add New Service</button>
        </div>

        <div id="services-grid" class="services-grid">
            <!-- Services loaded here -->
        </div>

        <!-- View Mode Information Section -->
        <div class="view-mode-info-section">
            <div class="info-header">
                <h3>üì± Choose Your Workspace Experience</h3>
                <p>Select the view that best suits your workflow when accessing any service</p>
            </div>

            <div class="view-mode-cards">
                <div class="view-mode-card">
                    <div class="view-mode-icon">üíº</div>
                    <h4>Web View (Professional Mode)</h4>
                    <p class="view-mode-description">
                        A structured, traditional interface designed for professionals who prefer organized checklists,
                        detailed forms, and panel-based workflows. Perfect for accountants and compliance officers who
                        need comprehensive control and visibility over every step of the process.
                    </p>
                    <ul class="view-mode-features">
                        <li>‚úì Structured checklists and step-by-step workflows</li>
                        <li>‚úì Multi-panel interface with detailed forms</li>
                        <li>‚úì Complete data visibility and control</li>
                        <li>‚úì Ideal for complex compliance tasks</li>
                    </ul>
                </div>

                <div class="view-mode-card">
                    <div class="view-mode-icon">üí¨</div>
                    <h4>AI Expert Chat View (Guided Mode)</h4>
                    <p class="view-mode-description">
                        An intelligent, conversational interface powered by AI that guides you through compliance tasks
                        with natural language interactions. The AI assistant asks relevant questions, provides
                        contextual
                        help, and simplifies complex processes into easy-to-understand conversations.
                    </p>
                    <ul class="view-mode-features">
                        <li>‚úì Conversational AI-guided assistance</li>
                        <li>‚úì Simplified, question-based workflow</li>
                        <li>‚úì Contextual help and smart suggestions</li>
                        <li>‚úì Perfect for quick tasks and beginners</li>
                    </ul>
                </div>
            </div>

            <div class="view-mode-note">
                <span class="note-icon">üí°</span>
                <p><strong>Pro Tip:</strong> You can switch between views at any time during your work. Choose Web View
                    for detailed control or AI Expert Chat View for guided simplicity.</p>
            </div>
        </div>
    </div>

    <!-- View Selection Modal -->
    <div id="view-modal" class="modal">
        <div class="modal-content">
            <h2 id="view-modal-title">Select Your Workspace</h2>
            <p>How would you like to process this service?</p>

            <div class="view-options">
                <div class="view-option" onclick="selectView('web')">
                    <div class="icon">üíº</div>
                    <h4>Web View</h4>
                    <p>Professional Mode: Structured checklists & panels</p>
                </div>
                <div class="view-option" onclick="selectView('chat')">
                    <div class="icon">üí¨</div>
                    <h4>Semi-Chat View</h4>
                    <p>Guided Simplicity: Conversational AI assistance</p>
                </div>
            </div>

            <button class="btn btn-secondary" style="margin-top: 2rem;"
                onclick="closeModal('view-modal')">Cancel</button>
        </div>
    </div>

    <!-- Manage Services Modal -->
    <div id="manage-services-modal" class="modal">
        <div class="modal-content">
            <h2>Add/Manage Services</h2>
            <p>Select the services you want to activate for this client.</p>

            <div id="available-services-list" class="service-selection-list">
                <!-- Loaded via JS -->
            </div>

            <div class="modal-actions" style="margin-top: 2rem; display: flex; gap: 1rem; justify-content: flex-end;">
                <button class="btn btn-secondary" onclick="closeModal('manage-services-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveServices()">Save Changes</button>
            </div>
        </div>
    </div>

    <script src="api_config.js"></script>
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const clientId = urlParams.get('clientId');
        let currentService = null;
        let allServices = [];
        let clientServices = [];
        const user = JSON.parse(localStorage.getItem('user'));

        if (!clientId) window.location.href = 'clients.html';

        async function loadDashboard() {
            await Promise.all([loadClientInfo(), loadAvailableServices()]);
        }

        async function loadClientInfo() {
            try {
                const response = await authFetch(`/clients/${clientId}`);
                if (!response) return;
                if (!response.ok) throw new Error(`Failed to load client (${response.status})`);

                const client = await response.json();

                // Update all client info displays
                const clientName = client.name;
                const initial = clientName.charAt(0).toUpperCase();
                const isCompany = clientName.toLowerCase().includes('ltd') || clientName.toLowerCase().includes('inc');
                const entityType = isCompany ? 'Private Limited' : 'Individual / Proprietor';

                // Navigation
                document.getElementById('client-name-nav').textContent = clientName;
                document.getElementById('client-type-nav').textContent = entityType;
                document.getElementById('nav-avatar').textContent = initial;

                // Breadcrumb and subtitle
                document.getElementById('breadcrumb-client').textContent = clientName;
                document.getElementById('subtitle-client-name').textContent = clientName;

                // Client Details Card
                document.getElementById('client-details-name').textContent = clientName;
                document.getElementById('client-entity-type').textContent = entityType;
                document.getElementById('client-icon-large').textContent = initial;

                // IDs
                document.getElementById('client-gstin').textContent = (client.gstins && client.gstins[0]) || '-';
                document.getElementById('client-pan').textContent = client.pan || '-';
                document.getElementById('client-cin').textContent = client.cin || '-';

                clientServices = client.services || [];
                document.getElementById('active-services-count').textContent = clientServices.length;

                renderActiveServices();
            } catch (err) {
                console.error('Client Load Error:', err);
                if (err.message.includes('401')) {
                    alert('Session expired. Please sign in again.');
                    window.location.href = 'sign-in.html';
                } else if (err.message.includes('404')) {
                    alert('Client not found.');
                    window.location.href = 'clients.html';
                } else {
                    alert(`Error loading client: ${err.message}`);
                }
            }
        }

        async function loadAvailableServices() {
            try {
                const response = await authFetch('/services/');
                if (response.ok) {
                    allServices = await response.json();
                }
            } catch (err) {
                console.error('Error fetching service templates:', err);
            }
        }

        function renderActiveServices() {
            const grid = document.getElementById('services-grid');
            grid.innerHTML = '';

            const serviceData = {
                'GST Refund': {
                    icon: 'üßæ',
                    desc: 'Complete GST return filing, input-output reconciliation, ITC claims, and real-time compliance tracking. Automated error detection and AI-powered suggestions for maximum refunds.'
                },
                'GST Filing': {
                    icon: 'üßæ',
                    desc: 'Complete GST return filing, input-output reconciliation, ITC claims, and real-time compliance tracking. Automated error detection and AI-powered suggestions for maximum refunds.'
                },
                'Income Tax': {
                    icon: 'üí∞',
                    desc: 'Comprehensive ITR filing for individuals and businesses, tax planning strategies, advance tax calculations, TDS management, and assessment support. AI-driven deduction optimization.'
                },
                'Audit': {
                    icon: 'üîç',
                    desc: 'Statutory audit, internal audit, tax audit, and compliance verification services. Detailed audit reports, risk assessment, and regulatory compliance checks with AI-powered anomaly detection.'
                },
                'Payroll': {
                    icon: 'üë•',
                    desc: 'End-to-end payroll processing, salary calculations, PF/ESI compliance, TDS deductions, Form 16 generation, and employee self-service portal. Automated compliance with labor laws.'
                },
                'Company Law': {
                    icon: 'üìã',
                    desc: 'ROC filings, annual returns (AOC-4, MGT-7), board resolutions, director appointments, share capital management, and complete corporate compliance under Companies Act 2013.'
                },
                'Accounting': {
                    icon: 'üìä',
                    desc: 'Professional bookkeeping, financial statement preparation, MIS reports, cash flow analysis, budgeting, and financial planning. Real-time dashboards and AI-powered insights.'
                },
                'Compliance': {
                    icon: '‚öñÔ∏è',
                    desc: 'Comprehensive regulatory compliance management, statutory filings, license renewals, compliance calendar, and automated alerts for upcoming deadlines. Multi-jurisdiction support.'
                }
            };

            clientServices.forEach(service => {
                const data = serviceData[service.name] || { icon: 'üì¶', desc: 'Professional service management' };
                const box = document.createElement('div');
                box.className = 'service-box-enhanced';
                box.onclick = () => openViewSelection(service);

                box.innerHTML = `
                    <div class="service-icon-large">${data.icon}</div>
                    <h3>${service.name}</h3>
                    <p class="service-description">${data.desc}</p>
                    <div class="service-footer">
                        <span class="status-pill status-active">Active</span>
                        <span class="service-action">View Details ‚Üí</span>
                    </div>
                `;
                grid.appendChild(box);
            });

            // Add "Add Service" box
            const addBox = document.createElement('div');
            addBox.className = 'service-box-enhanced add-service-box';
            addBox.onclick = showAddService;
            addBox.innerHTML = `
                <div class="service-icon-large">+</div>
                <h3>Add Service</h3>
                <p class="service-description">Activate additional compliance services</p>
            `;
            grid.appendChild(addBox);
        }

        function openViewSelection(service) {
            currentService = service;
            // Requirement 2: Show "Coming Soon" for non-GST Refund
            if (service.name !== 'GST Refund') {
                alert(`${service.name} is coming soon! Stay tuned.`);
                return;
            }
            document.getElementById('view-modal-title').textContent = `GST Refund for ${document.getElementById('selected-client-name').textContent}`;
            document.getElementById('view-modal').classList.add('active');
        }

        function showAddService() {
            const list = document.getElementById('available-services-list');
            list.innerHTML = '';

            allServices.forEach(service => {
                const isChecked = clientServices.some(s => s.id === service.id);
                const item = document.createElement('div');
                item.className = 'service-selection-item';
                item.onclick = () => {
                    const cb = item.querySelector('input');
                    cb.checked = !cb.checked;
                };

                item.innerHTML = `
                    <input type="checkbox" data-id="${service.id}" ${isChecked ? 'checked' : ''} onclick="event.stopPropagation()">
                    <div class="service-info">
                        <h4>${service.name}</h4>
                        <p>${service.description || ''}</p>
                    </div>
                `;
                list.appendChild(item);
            });

            document.getElementById('manage-services-modal').classList.add('active');
        }

        async function saveServices() {
            const checkboxes = document.querySelectorAll('#available-services-list input[type="checkbox"]');
            const selectedIds = Array.from(checkboxes).filter(cb => cb.checked).map(cb => cb.dataset.id);

            try {
                const response = await authFetch(`/clients/${clientId}/services`, {
                    method: 'PUT',
                    body: JSON.stringify({ service_ids: selectedIds })
                });

                if (response.ok) {
                    closeModal('manage-services-modal');
                    await loadClientInfo();
                } else {
                    alert('Failed to update services.');
                }
            } catch (err) {
                console.error(err);
                alert('Connection error while updating services.');
            }
        }

        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
        }

        function selectView(viewType) {
            // Requirement 3: Web View or Semi Chat View
            if (viewType === 'web') {
                window.location.href = `service-gst-refund.html?clientId=${clientId}&view=web`;
            } else {
                window.location.href = `service-gst-refund.html?clientId=${clientId}&view=semi-chat`;
            }
        }

        loadDashboard();
    </script>
</body>

</html>